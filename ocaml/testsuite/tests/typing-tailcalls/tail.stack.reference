[
  structure_item (tail.ml[18,521+0]..tail.ml[19,537+35])
    Tstr_value Rec
    [
      <def_rec>
        pattern (tail.ml[18,521+8]..tail.ml[18,521+11])
          Tpat_var "foo"
          value_mode global,many,shared
        expression (tail.ml[18,521+12]..tail.ml[19,537+35]) ghost
          Texp_function
          region true
          alloc_mode global,many,shared
          [
            Nolabel
            Param_pat
              pattern (tail.ml[18,521+12]..tail.ml[18,521+13])
                Tpat_var "n"
                value_mode global,many,shared
          ]
          Tfunction_body
            expression (tail.ml[19,537+2]..tail.ml[19,537+35])
              Texp_ifthenelse
              expression (tail.ml[19,537+5]..tail.ml[19,537+10])
                Texp_apply
                apply_mode Default
                locality_mode global
                expression (tail.ml[19,537+7]..tail.ml[19,537+8])
                  Texp_ident "Stdlib!.>"
                [
                  <arg>
                    Nolabel
                    expression (tail.ml[19,537+5]..tail.ml[19,537+6])
                      Texp_ident "n"
                  <arg>
                    Nolabel
                    expression (tail.ml[19,537+9]..tail.ml[19,537+10])
                      Texp_constant Const_int 0
                ]
              expression (tail.ml[19,537+16]..tail.ml[19,537+27])
                Texp_apply
                apply_mode Tail
                locality_mode global
                expression (tail.ml[19,537+16]..tail.ml[19,537+19])
                  Texp_ident "foo"
                [
                  <arg>
                    Nolabel
                    expression (tail.ml[19,537+20]..tail.ml[19,537+27])
                      Texp_apply
                      apply_mode Default
                      locality_mode global
                      expression (tail.ml[19,537+23]..tail.ml[19,537+24])
                        Texp_ident "Stdlib!.-"
                      [
                        <arg>
                          Nolabel
                          expression (tail.ml[19,537+21]..tail.ml[19,537+22])
                            Texp_ident "n"
                        <arg>
                          Nolabel
                          expression (tail.ml[19,537+25]..tail.ml[19,537+26])
                            Texp_constant Const_int 2
                      ]
                ]
              Some
                expression (tail.ml[19,537+33]..tail.ml[19,537+35])
                  Texp_construct "()"
                  []
    ]
  structure_item (tail.ml[21,574+0]..tail.ml[23,626+23])
    Tstr_value Rec
    [
      <def_rec>
        pattern (tail.ml[21,574+8]..tail.ml[21,574+11])
          Tpat_var "bar"
          value_mode global,many,shared
        expression (tail.ml[21,574+12]..tail.ml[22,590+35]) ghost
          Texp_function
          region true
          alloc_mode global,many,shared
          [
            Nolabel
            Param_pat
              pattern (tail.ml[21,574+12]..tail.ml[21,574+13])
                Tpat_var "n"
                value_mode global,many,shared
          ]
          Tfunction_body
            expression (tail.ml[22,590+2]..tail.ml[22,590+35])
              Texp_ifthenelse
              expression (tail.ml[22,590+5]..tail.ml[22,590+10])
                Texp_apply
                apply_mode Default
                locality_mode global
                expression (tail.ml[22,590+7]..tail.ml[22,590+8])
                  Texp_ident "Stdlib!.>"
                [
                  <arg>
                    Nolabel
                    expression (tail.ml[22,590+5]..tail.ml[22,590+6])
                      Texp_ident "n"
                  <arg>
                    Nolabel
                    expression (tail.ml[22,590+9]..tail.ml[22,590+10])
                      Texp_constant Const_int 0
                ]
              expression (tail.ml[22,590+16]..tail.ml[22,590+27])
                Texp_apply
                apply_mode Tail
                locality_mode global
                expression (tail.ml[22,590+16]..tail.ml[22,590+19])
                  Texp_ident "baz"
                [
                  <arg>
                    Nolabel
                    expression (tail.ml[22,590+20]..tail.ml[22,590+27])
                      Texp_apply
                      apply_mode Default
                      locality_mode global
                      expression (tail.ml[22,590+23]..tail.ml[22,590+24])
                        Texp_ident "Stdlib!.-"
                      [
                        <arg>
                          Nolabel
                          expression (tail.ml[22,590+21]..tail.ml[22,590+22])
                            Texp_ident "n"
                        <arg>
                          Nolabel
                          expression (tail.ml[22,590+25]..tail.ml[22,590+26])
                            Texp_constant Const_int 2
                      ]
                ]
              Some
                expression (tail.ml[22,590+33]..tail.ml[22,590+35])
                  Texp_construct "()"
                  []
      <def_rec>
        pattern (tail.ml[23,626+4]..tail.ml[23,626+7])
          Tpat_var "baz"
          value_mode global,many,shared
        expression (tail.ml[23,626+8]..tail.ml[23,626+23]) ghost
          Texp_function
          region true
          alloc_mode global,many,shared
          [
            Nolabel
            Param_pat
              pattern (tail.ml[23,626+8]..tail.ml[23,626+9])
                Tpat_var "n"
                value_mode global,many,unique
          ]
          Tfunction_body
            expression (tail.ml[23,626+12]..tail.ml[23,626+23])
              Texp_apply
              apply_mode Tail
              locality_mode global
              expression (tail.ml[23,626+12]..tail.ml[23,626+15])
                Texp_ident "bar"
              [
                <arg>
                  Nolabel
                  expression (tail.ml[23,626+16]..tail.ml[23,626+23])
                    Texp_apply
                    apply_mode Default
                    locality_mode global
                    expression (tail.ml[23,626+19]..tail.ml[23,626+20])
                      Texp_ident "Stdlib!.+"
                    [
                      <arg>
                        Nolabel
                        expression (tail.ml[23,626+17]..tail.ml[23,626+18])
                          Texp_ident "n"
                      <arg>
                        Nolabel
                        expression (tail.ml[23,626+21]..tail.ml[23,626+22])
                          Texp_constant Const_int 1
                    ]
              ]
    ]
  structure_item (tail.ml[28,865+0]..tail.ml[34,1006+31])
    Tstr_value Rec
    [
      <def_rec>
        pattern (tail.ml[28,865+8]..tail.ml[28,865+15])
          Tpat_var "collatz"
          value_mode global,many,shared
        expression (tail.ml[28,865+16]..tail.ml[34,1006+31]) ghost
          Texp_function
          region true
          alloc_mode global,many,shared
          [
            Nolabel
            Param_pat
              pattern (tail.ml[28,865+16]..tail.ml[28,865+17])
                Tpat_var "n"
                value_mode global,many,shared
            Nolabel
            Param_pat
              pattern (tail.ml[28,865+18]..tail.ml[28,865+19])
                Tpat_var "k"
                value_mode global,many,shared
          ]
          Tfunction_body
            expression (tail.ml[29,887+2]..tail.ml[34,1006+31])
              Texp_let Nonrec
              [
                <def>
                  pattern (tail.ml[29,887+6]..tail.ml[29,887+10])
                    Tpat_var "next"
                    value_mode meet_local,once(76[global,many,local,many]),shared
                  expression (tail.ml[29,887+11]..tail.ml[32,985+15]) ghost
                    Texp_function
                    region true
                    alloc_mode local,many,shared
                    [
                      Nolabel
                      Param_pat
                        pattern (tail.ml[29,887+11]..tail.ml[29,887+12])
                          Tpat_var "n"
                          value_mode map_comonadic(local_to_regional)(7a[global,many,local,many]),join_shared(7b[shared,unique])
                      Nolabel
                      Param_pat
                        pattern (tail.ml[29,887+13]..tail.ml[29,887+14])
                          Tpat_var "k"
                          value_mode map_comonadic(local_to_regional)(80[global,many,local,many]),join_shared(81[shared,unique])
                    ]
                    Tfunction_body
                      expression (tail.ml[30,904+4]..tail.ml[32,985+15])
                        Texp_let Nonrec
                        [
                          <def>
                            pattern (tail.ml[30,904+8]..tail.ml[30,904+9])
                              Tpat_var "n"
                              value_mode meet_local,once(84[global,many,local,once]),join_shared(85[shared,unique])
                            expression (tail.ml[30,904+12]..tail.ml[30,904+17])
                              Texp_apply
                              apply_mode Default
                              locality_mode global
                              expression (tail.ml[30,904+14]..tail.ml[30,904+15])
                                Texp_ident "Stdlib!.-"
                              [
                                <arg>
                                  Nolabel
                                  expression (tail.ml[30,904+12]..tail.ml[30,904+13])
                                    Texp_ident "n"
                                <arg>
                                  Nolabel
                                  expression (tail.ml[30,904+16]..tail.ml[30,904+17])
                                    Texp_constant Const_int 1
                              ]
                          <def>
                            pattern (tail.ml[31,922+8]..tail.ml[31,922+9])
                              Tpat_var "k"
                              value_mode meet_local,once(86[global,many,local,once]),join_shared(87[shared,unique])
                            expression (tail.ml[31,922+12]..tail.ml[31,922+59])
                              Texp_ifthenelse
                              expression (tail.ml[31,922+15]..tail.ml[31,922+27])
                                Texp_apply
                                apply_mode Default
                                locality_mode global
                                expression (tail.ml[31,922+23]..tail.ml[31,922+25])
                                  Texp_ident "Stdlib!.=="
                                [
                                  <arg>
                                    Nolabel
                                    expression (tail.ml[31,922+15]..tail.ml[31,922+22])
                                      Texp_apply
                                      apply_mode Default
                                      locality_mode global
                                      expression (tail.ml[31,922+17]..tail.ml[31,922+20])
                                        Texp_ident "Stdlib!.mod"
                                      [
                                        <arg>
                                          Nolabel
                                          expression (tail.ml[31,922+15]..tail.ml[31,922+16])
                                            Texp_ident "k"
                                        <arg>
                                          Nolabel
                                          expression (tail.ml[31,922+21]..tail.ml[31,922+22])
                                            Texp_constant Const_int 2
                                      ]
                                  <arg>
                                    Nolabel
                                    expression (tail.ml[31,922+26]..tail.ml[31,922+27])
                                      Texp_constant Const_int 0
                                ]
                              expression (tail.ml[31,922+33]..tail.ml[31,922+40])
                                Texp_apply
                                apply_mode Default
                                locality_mode global
                                expression (tail.ml[31,922+36]..tail.ml[31,922+37])
                                  Texp_ident "Stdlib!./"
                                [
                                  <arg>
                                    Nolabel
                                    expression (tail.ml[31,922+34]..tail.ml[31,922+35])
                                      Texp_ident "k"
                                  <arg>
                                    Nolabel
                                    expression (tail.ml[31,922+38]..tail.ml[31,922+39])
                                      Texp_constant Const_int 2
                                ]
                              Some
                                expression (tail.ml[31,922+46]..tail.ml[31,922+59])
                                  Texp_apply
                                  apply_mode Default
                                  locality_mode global
                                  expression (tail.ml[31,922+55]..tail.ml[31,922+56])
                                    Texp_ident "Stdlib!.+"
                                  [
                                    <arg>
                                      Nolabel
                                      expression (tail.ml[31,922+47]..tail.ml[31,922+54])
                                        Texp_apply
                                        apply_mode Default
                                        locality_mode global
                                        expression (tail.ml[31,922+50]..tail.ml[31,922+51])
                                          Texp_ident "Stdlib!.*"
                                        [
                                          <arg>
                                            Nolabel
                                            expression (tail.ml[31,922+48]..tail.ml[31,922+49])
                                              Texp_constant Const_int 3
                                          <arg>
                                            Nolabel
                                            expression (tail.ml[31,922+52]..tail.ml[31,922+53])
                                              Texp_ident "k"
                                        ]
                                    <arg>
                                      Nolabel
                                      expression (tail.ml[31,922+57]..tail.ml[31,922+58])
                                        Texp_constant Const_int 1
                                  ]
                        ]
                        expression (tail.ml[32,985+4]..tail.ml[32,985+15])
                          Texp_apply
                          apply_mode Tail
                          locality_mode global
                          expression (tail.ml[32,985+4]..tail.ml[32,985+11])
                            Texp_ident "collatz"
                          [
                            <arg>
                              Nolabel
                              expression (tail.ml[32,985+12]..tail.ml[32,985+13])
                                Texp_ident "n"
                            <arg>
                              Nolabel
                              expression (tail.ml[32,985+14]..tail.ml[32,985+15])
                                Texp_ident "k"
                          ]
              ]
              expression (tail.ml[34,1006+2]..tail.ml[34,1006+31])
                Texp_ifthenelse
                expression (tail.ml[34,1006+5]..tail.ml[34,1006+10])
                  Texp_apply
                  apply_mode Default
                  locality_mode global
                  expression (tail.ml[34,1006+7]..tail.ml[34,1006+8])
                    Texp_ident "Stdlib!.>"
                  [
                    <arg>
                      Nolabel
                      expression (tail.ml[34,1006+5]..tail.ml[34,1006+6])
                        Texp_ident "n"
                    <arg>
                      Nolabel
                      expression (tail.ml[34,1006+9]..tail.ml[34,1006+10])
                        Texp_constant Const_int 0
                  ]
                expression (tail.ml[34,1006+16]..tail.ml[34,1006+24])
                  Texp_apply
                  apply_mode Nontail
                  locality_mode global
                  expression (tail.ml[34,1006+16]..tail.ml[34,1006+20])
                    Texp_ident "next"
                  [
                    <arg>
                      Nolabel
                      expression (tail.ml[34,1006+21]..tail.ml[34,1006+22])
                        Texp_ident "n"
                    <arg>
                      Nolabel
                      expression (tail.ml[34,1006+23]..tail.ml[34,1006+24])
                        Texp_ident "k"
                  ]
                Some
                  expression (tail.ml[34,1006+30]..tail.ml[34,1006+31])
                    Texp_ident "k"
    ]
]

(letrec
  (foo
     (function {nlocal = 0} n[int] : int (if (> n 0) (apply foo (- n 2)) 0)))
  (letrec
    (bar
       (function {nlocal = 0} n[int] : int
         (if (> n 0) (apply baz (- n 2)) 0))
      baz (function {nlocal = 0} n[int] : int (apply bar (+ n 1))))
    (letrec
      (collatz
         (function {nlocal = 0} n[int] k[int] : int
           (region
             (if (> n 0)
               (let
                 (n =[int] (- n 1)
                  k =[int] (if (== (mod k 2) 0) (/ k 2) (+ (* 3 k) 1)))
                 (apply collatz n k))
               k))))
      (makeblock 0 foo bar baz collatz))))
